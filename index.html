<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カラオケ曲管理</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    #randomSong {
      margin-bottom: 5px; /* 下の余白を減らして全体を上に寄せる */
      font-size: 18px;
    }
    #songList {
      margin-top: 5px;  /* 上の余白を小さく */
      padding-top: 0;
      border-top: 1px solid #ccc; /* 線で区切る */
    }
    .song-item {
      display: flex;
      align-items: center;
      padding: 4px 0;
    }
    .song-item.played {
      color: #888;
      text-decoration: line-through;
    }
    button {
      margin-left: 10px;
      padding: 3px 6px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      background: #f0f0f0;
      cursor: pointer;
    }
    button:hover {
      background: #e0e0e0;
    }
    .fade-slide {
      animation: fadeSlide 0.6s ease;
    }
    @keyframes fadeSlide {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <h2>カラオケ曲管理</h2>
  <input type="text" id="songInput" placeholder="曲名を入力">
  <button onclick="addSong()">追加</button>
  <button onclick="showRandomSong()">ランダム表示</button>
  <button onclick="resetSongs()">リセット</button>

  <div id="randomSong"></div>

  <div id="songList"></div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let songs = [];

    async function loadSongs() {
      const snapshot = await db.collection("songs").get();
      songs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderList();
    }

    async function addSong() {
      const input = document.getElementById("songInput");
      const name = input.value.trim();
      if (!name) return;
      const docRef = await db.collection("songs").add({ name, playedToday: false });
      songs.push({ id: docRef.id, name, playedToday: false });
      input.value = "";
      renderList();
    }

    async function showRandomSong() {
      const display = document.getElementById("randomSong");
      display.innerHTML = "";
      const unplayed = songs.filter(s => !s.playedToday);
      if (unplayed.length === 0) {
        display.innerText = "今日の曲は全部出たよ。リセットしてね。";
        return;
      }
      const index = Math.floor(Math.random() * unplayed.length);
      const song = unplayed[index];

      // 一旦チェックつける
      await db.collection("songs").doc(song.id).update({ playedToday: true });
      songs.find(s => s.id === song.id).playedToday = true;
      renderList();

      // 表示
      const container = document.createElement("div");
      container.classList.add("fade-slide");
      container.innerHTML = `🎤 ${song.name}`;

      // 保留ボタン
      const holdBtn = document.createElement("button");
      holdBtn.textContent = "保留";
      holdBtn.onclick = async () => {
        await db.collection("songs").doc(song.id).update({ playedToday: false });
        songs.find(s => s.id === song.id).playedToday = false;
        renderList();
        display.innerHTML = `⏸️ ${song.name} を保留しました`;
      };

      container.appendChild(holdBtn);
      display.appendChild(container);
    }

    async function resetSongs() {
      const batch = db.batch();
      songs.forEach(song => {
        const ref = db.collection("songs").doc(song.id);
        batch.update(ref, { playedToday: false });
      });
      await batch.commit();
      songs.forEach(s => s.playedToday = false);
      renderList();
      document.getElementById("randomSong").innerHTML = "";
    }

    function renderList() {
      const list = document.getElementById("songList");
      list.innerHTML = "";
      songs.forEach(song => {
        const item = document.createElement("div");
        item.className = "song-item" + (song.playedToday ? " played" : "");
        item.textContent = song.name;
        list.appendChild(item);
      });
    }

    loadSongs();
  </script>
</body>
</html>
